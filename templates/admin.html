<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å –∑–∞–∫–∞–∑–æ–≤</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f4f8;
        }
        .card {
            border-radius: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #A498DE;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .rounded-circle {
            border: 3px solid #e0e0e0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .badge.bg-warning {
            background-color: #87bdd8 !important;
            color: #fff;
        }
        .badge.bg-success {
            background-color: #A498DE !important;
        }
        .lang-switcher {
            margin-right: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .lang-switcher:hover {
            background-color: #f8f9fa;
        }

        @media (max-width: 768px) {
            .card-body h2 {
                font-size: 1.25rem;
            }
            .card img {
                width: 100px !important;
                height: 100px !important;
            }
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <i class="fas fa-tools me-2"></i>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        </a>
        <div class="d-flex align-items-center">
            <div class="lang-switcher" id="langSwitcher">
                <span class="lang-flag">üá∑üá∫</span> <span class="lang-text">RU</span>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4 mb-5">
    {% if current_user.id in [1, 2] %}
    <h1 class="text-primary fw-bold mb-4" data-i18n="all_orders">–í—Å–µ –∑–∞–∫–∞–∑—ã</h1>

    {% for order in orders %}
    <div class="text-decoration-none text-dark" role="button"
         data-bs-toggle="offcanvas"
         data-bs-target="#offcanvasOrder{{ order.id }}"
         aria-controls="offcanvasOrder{{ order.id }}">
        <div class="card mb-4 shadow-sm">
            <div class="row g-0">
                <div class="col-md-3 d-flex align-items-center justify-content-center p-3">
                    {% if order.picture %}
                    <img src="data:image/jpeg;base64,{{ order.picture | b64encode }}"
                         class="img-fluid rounded-circle"
                         alt="Order image"
                         style="width: 150px; height: 150px; object-fit: cover;">
                    {% else %}
                    <img src="{{ url_for('static', filename='images/default-order.png') }}"
                         class="img-fluid rounded-circle"
                         alt="Default order image"
                         style="width: 150px; height: 150px; object-fit: cover;">
                    {% endif %}
                </div>
                <div class="col-md-9">
                    <div class="card-body">
                        <h2 class="card-title text-dark">{{ order.description }}</h2>
                        <p class="card-text">
                            <i class="fas fa-map-marker-alt text-secondary me-1"></i> {{ order.address }}
                        </p>
                        <div class="mb-2">
                            {% if not order.is_ready %}
                            <span class="badge bg-warning text-dark" data-i18n="in_progress">
                                <i class="fas fa-hourglass-half me-1"></i> –í —Ä–∞–±–æ—Ç–µ
                            </span>
                            {% else %}
                            <span class="badge bg-success" data-i18n="completed">
                                <i class="fas fa-check-circle me-1"></i> –ì–æ—Ç–æ–≤
                            </span>
                            {% endif %}
                        </div>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="far fa-calendar-alt me-1"></i> {{ order.created_date.strftime('%d %b %Y') }}
                            </small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Offcanvas -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasOrder{{ order.id }}"
         aria-labelledby="offcanvasOrderLabel{{ order.id }}">
        <div class="offcanvas-header">
            <h5 id="offcanvasOrderLabel{{ order.id }}" data-i18n="order_number">–ó–∞–∫–∞–∑ ‚Ññ{{ order.id }}</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                    aria-label="Close"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column">
            {% if order.picture %}
            <img src="data:image/jpeg;base64,{{ order.picture | b64encode }}"
                 class="img-fluid rounded mb-3" style="max-width: 100%;">
            {% endif %}
            <ul class="list-group list-group-flush mb-3">
                <li class="list-group-item"><strong data-i18n="name">–ò–º—è:</strong> {{ order.user_name }}</li>
                <li class="list-group-item"><strong data-i18n="surname">–§–∞–º–∏–ª–∏—è:</strong> {{ order.user_surname }}</li>
                <li class="list-group-item"><strong data-i18n="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ order.phone_number }}</li>
                <li class="list-group-item"><strong data-i18n="address">–ê–¥—Ä–µ—Å:</strong> {{ order.address }}</li>
                <li class="list-group-item"><strong data-i18n="description">–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ order.description }}</li>
                <li class="list-group-item"><strong data-i18n="created">–°–æ–∑–¥–∞–Ω:</strong> {{ order.created_date.strftime('%d %b %Y') }}</li>
                <li class="list-group-item">
                    <strong data-i18n="status">–°—Ç–∞—Ç—É—Å:</strong>
                    {% if order.is_ready %}
                    <span class="badge bg-success" data-i18n="completed">–ì–æ—Ç–æ–≤</span>
                    {% else %}
                    <span class="badge bg-warning text-dark" data-i18n="in_progress">–í —Ä–∞–±–æ—Ç–µ</span>
                    {% endif %}
                </li>
            </ul>

            <form action="{{ url_for('change_status', order_id=order.id) }}" method="post" class="mb-2">
                <button type="submit" class="btn btn-outline-primary w-100" data-i18n="change_status">
                    <i class="fas fa-sync-alt me-1"></i> –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                </button>
            </form>
            <form action="{{ url_for('delete_order', order_id=order.id) }}" method="post"
                  onsubmit="return confirm(lang === 'ru' ? '–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?' : 'Delete this order?');">
                <button type="submit" class="btn btn-outline-danger w-100" data-i18n="delete">
                    <i class="fas fa-trash me-1"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </form>
        </div>
    </div>
    {% endfor %}

    {% else %}
    <div class="alert alert-danger" role="alert" data-i18n="no_access">
        –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –ø–∞–Ω–µ–ª–∏.
    </div>
    {% endif %}
</div>

<!-- JS Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Language management
    let lang = 'ru';
    const translations = {
        ru: {
            "all_orders": "–í—Å–µ –∑–∞–∫–∞–∑—ã",
            "in_progress": "–í —Ä–∞–±–æ—Ç–µ",
            "completed": "–ì–æ—Ç–æ–≤",
            "order_number": "–ó–∞–∫–∞–∑ ‚Ññ",
            "name": "–ò–º—è:",
            "surname": "–§–∞–º–∏–ª–∏—è:",
            "phone": "–¢–µ–ª–µ—Ñ–æ–Ω:",
            "address": "–ê–¥—Ä–µ—Å:",
            "description": "–û–ø–∏—Å–∞–Ω–∏–µ:",
            "created": "–°–æ–∑–¥–∞–Ω:",
            "status": "–°—Ç–∞—Ç—É—Å:",
            "change_status": "–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å",
            "delete": "–£–¥–∞–ª–∏—Ç—å",
            "no_access": "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –ø–∞–Ω–µ–ª–∏."
        },
        en: {
            "all_orders": "All Orders",
            "in_progress": "In Progress",
            "completed": "Completed",
            "order_number": "Order #",
            "name": "Name:",
            "surname": "Surname:",
            "phone": "Phone:",
            "address": "Address:",
            "description": "Description:",
            "created": "Created:",
            "status": "Status:",
            "change_status": "Change Status",
            "delete": "Delete",
            "no_access": "You don't have access to this panel."
        }
    };

    // Switch language function
    function switchLanguage() {
        lang = lang === 'ru' ? 'en' : 'ru';
        updateLanguage();
        localStorage.setItem('adminPanelLang', lang);
    }

    // Update all text elements
    function updateLanguage() {
        // Update switcher
        const switcher = document.getElementById('langSwitcher');
        switcher.innerHTML = lang === 'ru'
            ? '<span class="lang-flag">üá∑üá∫</span> <span class="lang-text">RU</span>'
            : '<span class="lang-flag">üá¨üáß</span> <span class="lang-text">EN</span>';

        // Update all translatable elements
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[lang][key]) {
                if (el.tagName === 'INPUT') {
                    el.value = translations[lang][key];
                } else {
                    // Handle order number separately
                    if (key === 'order_number' && el.textContent.includes('–ó–∞–∫–∞–∑ ‚Ññ')) {
                        el.textContent = translations[lang][key] + el.textContent.split('–ó–∞–∫–∞–∑ ‚Ññ')[1];
                    } else if (key === 'order_number' && el.textContent.includes('Order #')) {
                        el.textContent = translations[lang][key] + el.textContent.split('Order #')[1];
                    } else {
                        el.textContent = translations[lang][key];
                    }
                }
            }
        });
    }

    // Initialize language
    document.addEventListener('DOMContentLoaded', () => {
        const savedLang = localStorage.getItem('adminPanelLang');
        if (savedLang) {
            lang = savedLang;
        }
        updateLanguage();

        // Add click event to switcher
        document.getElementById('langSwitcher').addEventListener('click', switchLanguage);
    });
</script>
</body>
</html>