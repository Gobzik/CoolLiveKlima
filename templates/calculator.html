<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ title or "Air Conditioner Installation" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

<!-- Header -->
<header>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Logo" height="40">
        <span class="logo-text">CoolLiveKlima</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" href="/install" data-i18n="installation">Installation</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/about_us" data-i18n="about_us">About us</a>
          </li>
        </ul>
        <div class="d-flex align-items-center">
          <div class="lang-switcher" id="langSwitcher">
            <span class="lang-flag">üá¨üáß</span> <span class="lang-text">EN</span>
          </div>
          {% if current_user.is_authenticated %}
            <a class="navbar-brand logout" href="/user_account">{{ current_user.name }}</a>
          {% else %}
            <form action="/login" method="get">
              <button type="submit" class="btn btn-primary entrance btn-new" data-i18n="login">Log in</button>
            </form>
            <form action="/register" method="get">
              <button type="submit" class="btn btn-primary sign_up btn-new" data-i18n="sign_up">Sign up</button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>
</header>

<div class="container py-5">
  <h1 class="mb-4 text-primary fw-bold text-center" data-aos="fade-down" data-i18n="calculator_title">Installation Cost Calculator</h1>

  {% if error %}
  <div class="alert alert-danger shadow-sm">{{ error }}</div>
  {% endif %}

  <div class="card shadow-lg border-0 mb-5" data-aos="fade-up">
    <div class="card-body p-4">
      <form id="calcForm" method="POST">
        <div class="row g-3 mb-3">
          <div class="col-md-4">
            <label class="form-label" data-i18n="line_length">Line length (m)</label>
            <input type="number" class="form-control" name="route_length" id="route_length" min="0" value="5" step="0.1" required>
            <div class="form-text" data-i18n="price_per_meter">Price per meter: {{ prices.route }} RUB</div>
          </div>
          <div class="col-md-4">
            <label class="form-label" data-i18n="groove_length">Groove length (m)</label>
            <input type="number" class="form-control" name="groove_length" id="groove_length" min="0" value="0" step="0.1">
            <div class="form-text" data-i18n="price_per_meter">Price per meter: {{ prices.groove }} RUB</div>
          </div>
          <div class="col-md-4">
            <label class="form-label" data-i18n="ac_units">Number of AC units</label>
            <input type="number" class="form-control" name="ac_count" id="ac_count" min="1" value="1" required>
          </div>
        </div>

        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label" data-i18n="ac_type">AC type</label>
            <select class="form-select" name="ac_type" id="ac_type">
              <option value="standard" selected data-i18n="ac_standard">Standard ({{ prices.ac.standard }} RUB)</option>
              <option value="inverter" data-i18n="ac_inverter">Inverter ({{ prices.ac.inverter }} RUB)</option>
              <option value="premium" data-i18n="ac_premium">Premium ({{ prices.ac.premium }} RUB)</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label" data-i18n="additional_options">Additional options</label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="extra_mounting" id="extra_mounting">
              <label class="form-check-label" for="extra_mounting" data-i18n="complex_installation">
                Complex installation <span class="badge bg-secondary ms-1">+{{ (prices.extra_mounting * 100)|round }}%</span>
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="warranty" id="warranty">
              <label class="form-check-label" for="warranty" data-i18n="extended_warranty">
                Extended warranty <span class="badge bg-accent text-white ms-1">+{{ (prices.warranty * 100)|round }}%</span>
              </label>
            </div>
          </div>
        </div>

      </form>
    </div>
  </div>

  <div id="resultBlock" class="card shadow border-0 bg-light d-none" data-aos="fade-up">
    <div class="card-body p-4">
      <h3 class="card-title text-center text-primary mb-4" data-i18n="total_cost">Total Cost</h3>
      <div class="row">
        <div class="col-md-6">
          <p><strong data-i18n="base_cost">Base cost:</strong> <span id="baseCost">0</span></p>
          <p><strong data-i18n="line_cost">Line cost:</strong> <span id="routeCost">0</span></p>
          <p><strong data-i18n="groove_cost">Groove cost:</strong> <span id="grooveCost">0</span></p>
        </div>
        <div class="col-md-6">
          <p><strong data-i18n="additional_work">Additional work:</strong> <span id="extraCost">0</span></p>
          <p><strong data-i18n="ac_units">Number of AC units:</strong> <span id="countDisplay">1</span></p>
            <h4 class="mb-0 text-dark"><strong data-i18n="total">Total:</strong> <span id="totalCost">0</span></h4>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();

  // Language switching functionality
  const translations = {
    en: {
      "installation": "Installation",
      "about_us": "About us",
      "login": "Log in",
      "sign_up": "Sign up",
      "calculator_title": "Installation Cost Calculator",
      "line_length": "Line length (m)",
      "groove_length": "Groove length (m)",
      "ac_units": "Number of AC units",
      "price_per_meter": "Price per meter: {{ prices.route }} RUB",
      "ac_type": "AC type",
      "ac_standard": "Standard ({{ prices.ac.standard }} RUB)",
      "ac_inverter": "Inverter ({{ prices.ac.inverter }} RUB)",
      "ac_premium": "Premium ({{ prices.ac.premium }} RUB)",
      "additional_options": "Additional options",
      "complex_installation": "Complex installation",
      "extended_warranty": "Extended warranty",
      "calculate": "Calculate",
      "total_cost": "Total Cost",
      "base_cost": "Base cost:",
      "line_cost": "Line cost:",
      "groove_cost": "Groove cost:",
      "additional_work": "Additional work:",
      "total": "Total:"
    },
    ru: {
      "installation": "–£—Å—Ç–∞–Ω–æ–≤–∫–∞",
      "about_us": "–û –Ω–∞—Å",
      "login": "–í–æ–π—Ç–∏",
      "sign_up": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
      "calculator_title": "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏",
      "line_length": "–î–ª–∏–Ω–∞ —Ç—Ä–∞—Å—Å—ã (–º)",
      "groove_length": "–î–ª–∏–Ω–∞ —à—Ç—Ä–æ–±—ã (–º)",
      "ac_units": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–æ–≤",
      "price_per_meter": "–¶–µ–Ω–∞ –∑–∞ –º–µ—Ç—Ä: {{ prices.route }} —Ä—É–±.",
      "ac_type": "–¢–∏–ø –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä–∞",
      "ac_standard": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π ({{ prices.ac.standard }} —Ä—É–±.)",
      "ac_inverter": "–ò–Ω–≤–µ—Ä—Ç–æ—Ä–Ω—ã–π ({{ prices.ac.inverter }} —Ä—É–±.)",
      "ac_premium": "–ü—Ä–µ–º–∏—É–º ({{ prices.ac.premium }} —Ä—É–±.)",
      "additional_options": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏",
      "complex_installation": "–°–ª–æ–∂–Ω—ã–π –º–æ–Ω—Ç–∞–∂",
      "extended_warranty": "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è",
      "calculate": "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å",
      "total_cost": "–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å",
      "base_cost": "–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:",
      "line_cost": "–°—Ç–æ–∏–º–æ—Å—Ç—å —Ç—Ä–∞—Å—Å—ã:",
      "groove_cost": "–°—Ç–æ–∏–º–æ—Å—Ç—å —à—Ç—Ä–æ–±—ã:",
      "additional_work": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:",
      "total": "–ò—Ç–æ–≥–æ:"
    }
  };

  let currentLang = 'en';

  function switchLanguage() {
    currentLang = currentLang === 'en' ? 'ru' : 'en';

    // Update button appearance
    const switcher = document.getElementById('langSwitcher');
    switcher.innerHTML = currentLang === 'en'
      ? '<span class="lang-flag">üá¨üáß</span> <span class="lang-text">EN</span>'
      : '<span class="lang-flag">üá∑üá∫</span> <span class="lang-text">RU</span>';

    // Update all translatable elements
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (translations[currentLang][key]) {
        if (el.tagName === 'INPUT') {
          el.placeholder = translations[currentLang][key];
        } else if (el.tagName === 'OPTION') {
          el.textContent = translations[currentLang][key];
        } else {
          el.textContent = translations[currentLang][key];
        }
      }
    });

    // Store preference in localStorage
    localStorage.setItem('preferredLang', currentLang);

    // Recalculate after language change
    calculate();
  }

  // Initialize language
  document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferredLang');
    if (savedLang) {
      currentLang = savedLang;
      if (currentLang === 'ru') {
        switchLanguage(); // Switch to Russian if it was saved
      }
    }

    document.getElementById('langSwitcher').addEventListener('click', switchLanguage);

    // Calculate on page load
    calculate();
  });

  const prices = {
    route: {{ prices.route }},
    groove: {{ prices.groove }},
    ac: {
      standard: {{ prices.ac.standard }},
      inverter: {{ prices.ac.inverter }},
      premium: {{ prices.ac.premium }}
    },
    extra_mounting: {{ prices.extra_mounting }},
    warranty: {{ prices.warranty }}
  };

  function calculate() {
    const routeLength = parseFloat(document.getElementById('route_length').value) || 0;
    const grooveLength = parseFloat(document.getElementById('groove_length').value) || 0;
    const acCount = parseInt(document.getElementById('ac_count').value) || 1;
    const acType = document.getElementById('ac_type').value;
    const extra = document.getElementById('extra_mounting').checked;
    const warranty = document.getElementById('warranty').checked;

    const baseCost = prices.ac[acType] * acCount;
    const routeCost = routeLength * prices.route * acCount;
    const grooveCost = grooveLength * prices.groove * acCount;

    let subtotal = baseCost + routeCost + grooveCost;
    let extraCost = 0;

    if (extra) extraCost += subtotal * prices.extra_mounting / 100;
    if (warranty) extraCost += subtotal * prices.warranty / 100;

    const total = subtotal + extraCost;

    // Format numbers based on current language
    const formatOptions = {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    };

    const locale = currentLang === 'ru' ? 'ru-RU' : 'en-US';

    document.getElementById('baseCost').textContent = baseCost.toLocaleString(locale, formatOptions);
    document.getElementById('routeCost').textContent = routeCost.toLocaleString(locale, formatOptions);
    document.getElementById('grooveCost').textContent = grooveCost.toLocaleString(locale, formatOptions);
    document.getElementById('extraCost').textContent = extraCost.toLocaleString(locale, formatOptions);
    document.getElementById('totalCost').textContent = total.toLocaleString(locale, formatOptions);
    document.getElementById('countDisplay').textContent = acCount;
    document.getElementById('resultBlock').classList.remove('d-none');
  }

  const inputs = document.querySelectorAll('#calcForm input, #calcForm select');
  inputs.forEach(el => el.addEventListener('input', calculate));
</script>
</body>
</html>